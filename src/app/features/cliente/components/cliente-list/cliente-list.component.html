<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="luxury-card">
  <div class="flex flex-column md:flex-row justify-content-between align-items-center md:align-items-end mb-6 gap-4">
    <div class="title-group">
      <span class="luxury-subtitle">Private Collection</span>
      <h2 class="luxury-title">Gestão de Clientes VIP</h2>
    </div>

    <div class="flex align-items-center gap-3 w-full md:w-auto">
      <span class="p-input-icon-left luxury-search w-full md:w-auto">
        <i class="pi pi-search"></i>
        <input
          pInputText
          type="text"
          (input)="dt.filterGlobal($any($event.target).value, 'contains')"
          placeholder="Pesquisar membro..."
          class="p-inputtext-sm luxury-search-input w-full"
        />
      </span>

      <button pButton
              label="NOVO CLIENTE"
              icon="pi pi-plus"
              class="p-button-text luxury-add-btn"
              (click)="irParaNovoCliente()">
      </button>
    </div>
  </div>

  <p-table
    #dt
    [value]="clientes"
    [globalFilterFields]="['nome', 'email', 'perfil']"
    [tableStyle]="{ 'min-width': '50rem' }"
    styleClass="p-datatable-luxury"
    [paginator]="true"
    [rows]="5"
    [rowsPerPageOptions]="[5, 10, 20]"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Exibindo {first} a {last} de {totalRecords} membros"
    [responsive]="true">

    <ng-template pTemplate="header">
      <tr>
        <th scope="col" pSortableColumn="nome">
          NOME <p-sortIcon field="nome"></p-sortIcon>
        </th>
        <th scope="col" pSortableColumn="perfil">
          PERFIL <p-sortIcon field="perfil"></p-sortIcon>
        </th>
        <th scope="col" class="text-right" pSortableColumn="gastoTotalAcumulado">
          GASTO ACUMULADO <p-sortIcon field="gastoTotalAcumulado"></p-sortIcon>
        </th>
        <th scope="col" class="text-center">AÇÕES</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-cliente>
      <tr class="luxury-row">
        <td class="font-medium text-900">
          <div class="flex flex-column">
            {{ cliente.nome }}
            <span class="text-xs text-400 font-light">{{ cliente.email }}</span>
          </div>
        </td>
        <td>
          <app-badge-perfil [perfil]="cliente.perfil"></app-badge-perfil>
        </td>
        <td class="text-right text-600 font-light">
          {{ cliente.gastoTotalAcumulado | currency:'BRL' }}
        </td>

        <td class="text-center action-cells">
          <button pButton
                  icon="pi pi-eye"
                  class="p-button-rounded p-button-text action-icon"
                  pTooltip="Visualizar Insights"
                  tooltipPosition="top"
                  (click)="abrirVisualizacao(cliente)">
          </button>

          <button pButton
                  icon="pi pi-pencil"
                  class="p-button-rounded p-button-text action-icon"
                  pTooltip="Editar Cadastro"
                  tooltipPosition="top"
                  (click)="abrirEdicao(cliente)">
          </button>

          <button pButton
                  icon="pi pi-trash"
                  class="p-button-rounded p-button-text p-button-danger action-icon"
                  pTooltip="Excluir do Acervo"
                  tooltipPosition="top"
                  (click)="confirmarExclusao(cliente.id)">
          </button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="4" class="text-center p-8">
          <i class="pi pi-search-minus text-4xl mb-3 block text-300"></i>
          <span class="text-600 font-light">Nenhum membro VIP corresponde à sua busca.</span>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<app-cliente-gestao-modal #gestaoModal (salvou)="carregarClientes()"></app-cliente-gestao-modal>
