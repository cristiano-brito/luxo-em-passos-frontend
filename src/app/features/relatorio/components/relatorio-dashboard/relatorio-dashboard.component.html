<section class="relatorio-container fadein">
  <header class="relatorio-header">
    <div class="header-flex">
      <div>
        <span class="category-tag">Business Intelligence</span>
        <h1>Performance de Vendas</h1>
      </div>

      <div class="filter-area">
        <button
          class="btn-export-pdf"
          (click)="baixarRelatorioPDF()"
          title="Gerar Relatório PDF">
          <i class="pi pi-file-pdf"></i>
          <span>EXPORTAR PDF</span>
        </button>

        <p-selectButton
          [options]="opcoesPeriodo"
          [(ngModel)]="periodoSelecionado"
          (onChange)="alterarFiltro()"
          optionLabel="label"
          optionValue="value">
        </p-selectButton>
      </div>
    </div>
  </header>

  <div class="kpi-grid">
    <p-card header="FATURAMENTO" class="kpi-card">
      <div class="kpi-value highlight">{{ kpis.faturamento | currency:'BRL' }}</div>
      <small class="kpi-label">Vendas Finalizadas ({{ kpis.periodoAtivo }})</small>
    </p-card>

    <p-card header="TICKET MÉDIO" class="kpi-card">
      <div class="kpi-value">{{ kpis.ticketMedio | currency:'BRL' }}</div>
      <small class="kpi-label">Média por Transação</small>
    </p-card>

    <p-card header="PEDIDOS" class="kpi-card">
      <div class="kpi-value">{{ kpis.totalVendas }}</div>
      <small class="kpi-label">Volume de Conversão</small>
    </p-card>

    <p-card header="ESTORNOS" class="kpi-card cancel-kpi">
      <div class="kpi-value">{{ kpis.totalCanceladas }}</div>
      <small class="kpi-label">Pedidos Cancelados</small>
    </p-card>
  </div>

  <div class="charts-grid">
    <p-card header="DISTRIBUIÇÃO POR CATEGORIA" class="chart-card">
      <div class="chart-wrapper">
        <p-chart
          type="doughnut"
          [data]="pieData"
          [options]="pieOptions"
          height="300px">
        </p-chart>
      </div>
    </p-card>

    <p-card header="TOP SPENDERS (CRM VIP)" class="ranking-card">
      <div class="ranking-container">
        <div *ngFor="let cliente of topClientes; let i = index" class="ranking-item">
          <div class="rank-number">{{ i + 1 }}º</div>
          <div class="rank-info">
            <span class="rank-name">{{ cliente.nome }}</span>
            <span class="rank-profile" [attr.data-perfil]="cliente.perfil">{{ cliente.perfil }}</span>
          </div>
          <div class="rank-value">{{ cliente.gastoAcumulado | currency:'BRL' }}</div>
        </div>
      </div>
    </p-card>
  </div>

  <div class="bottom-grid">
    <p-card header="EVOLUÇÃO MENSAL" class="bar-chart-card">
      <div class="chart-wrapper">
        <p-chart
          type="bar"
          [data]="barData"
          [options]="barOptions"
          height="300px">
        </p-chart>
      </div>
    </p-card>

    <p-card header="ESTOQUE CRÍTICO" class="stock-card">
      <div class="stock-list">
        <div *ngFor="let produto of produtosCriticos" class="stock-item">
          <div class="product-info">
            <div class="prod-main">
              <span class="sku">{{ produto.sku }}</span>
              <span class="modelo">{{ produto.modelo }}</span>
            </div>
            <div class="stock-status-wrapper">
              <span class="stock-qty">{{ produto.estoque }} un.</span>
              <span class="stock-badge" [class.danger]="produto.estoque <= 3">
                {{ produto.estoque <= 3 ? 'CRÍTICO' : 'BAIXO' }}
              </span>
            </div>
          </div>
          <div class="progress-bar-bg">
            <div class="progress-fill" [class.bg-danger]="produto.estoque <= 3"
              [style.width.%]="(produto.estoque / 10) * 100">
            </div>
          </div>
        </div>
      </div>
    </p-card>
  </div>
</section>
